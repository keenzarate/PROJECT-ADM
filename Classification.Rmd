---
title: "Analysis"
author: "Keen"
date: "5/14/2019"
output: html_document
---

```{r}
suppressMessages(library(dplyr))
suppressMessages(library(tidyverse))
suppressMessages(library(ggplot2))
suppressMessages(library(MASS))
suppressMessages(library(tree))
suppressMessages(library(randomForest))
```

Upload the data set and convert to data frame:
```{r}
dat <-read.csv("~/Desktop/PROJECT-ADM-master/ADM/WA_Fn-UseC_-HR-Employee-Attrition.csv")
dat.df <- as.data.frame(dat)
```


##Exploratory data set

**Simple plot using train data: Here I am interested in looking at how MonthlyIncome is affected by Age in terms of the TotalWorkingYears. Later, we are gunna try to predict the relationship of this and try to cluster. We can define the number of cluster that we want in terms of the TotalWorkingYears. We are gunna try to cluster this in a moment.**

```{r}
ggplot(dat.df)+
  geom_point(aes(Age,MonthlyIncome,color=factor(TotalWorkingYears)))
```

##Let's just do a bit of data clean up. We can try to put this in four categories. 
```{r}
dat.df <- mutate(dat.df,
                 NewTotYears=ifelse(TotalWorkingYears <= 7 & TotalWorkingYears >=0, "Beginning",
                                    ifelse(TotalWorkingYears <= 15 & TotalWorkingYears >7, "Novice",
                                           ifelse(TotalWorkingYears <= 25 & TotalWorkingYears >15,"Intermediate",
                                                  ifelse(TotalWorkingYears <= 40 & TotalWorkingYears >25,"Expert","None")))))

dat.df <- dat.df %>% mutate(NewTotYears=as.factor(NewTotYears))
```

Plott the new data set:
```{r}
#View(dat.df)
ggplot(dat.df) +
  geom_point(aes(Age, MonthlyIncome,color=factor(NewTotYears)))+
  scale_x_continuous(breaks =seq(min(dat.df$Age,max(dat.df$Age,by=0.5))))
```

Split data into train and test train.
```{r}
n0 <- nrow(dat.df)
train <- sample(1:n0,n0/2,rep=F)
train.df <- dat.df[train,]
test.df <- dat.df[-train,]
#names(train.df)
```

Start with LDA using all predictors
```{r}
mod.lda <- lda(TotalWorkingYears ~ Age+MonthlyIncome, data=train.df)
#mod.lda
pred.lda <- predict(mod.lda,newdata=test.df)
test.df <- test.df %>%
  mutate(pred=pred.lda$class)
##how good does it work
with(test.df,table(TotalWorkingYears,pred))
```
Working on scaling the values
```{r}
#View(test.df)
Wvec <- mod.lda$scaling
val <- (dim(Wvec))
val <- as.numeric(val)
X <- data.matrix(test.df[,1:val])
sum(Wvec[,1]^2)
(s1 <- sum(Wvec[,1]^2))
(s2 <- sum(Wvec[,2]^2))
(Wvec[,1] <- Wvec[,1]/s1)
(Wvec[,2] <- Wvec[,2]/s2)
X.trans <- X %*% Wvec
dim(X.trans)
Wvec
```

```{r}
testTrans.df <- data.frame(TotalWorkingYears=factor(test.df$TotalWorkingYears),LDA1=X.trans[,1],LDA2=X.trans[,2])
ggplot(testTrans.df,aes(LDA1,LDA2,color=TotalWorkingYears))+
  geom_point()
```
Random Forest
```{r}



```